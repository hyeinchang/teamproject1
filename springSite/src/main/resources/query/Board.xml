<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.client.board.dao.BoardDao">
<!-- <select id="boardList" resultType="board">
	select b_num, b_name, b_title,
	to_char(b_date,'yyyy-MM-dd') as b_date
	from spring_board order by b_num desc
</select> -->
<sql id="boardCommon">
	select b_num, b_name, b_title, b_date from spring_board
	<where>
		<if test="search=='b_title'">
			<![CDATA[b_title like '%'||#{keyword}||'%']]>
		</if>
		<if test="search=='b_content'">
			<![CDATA[b_content like '%'||#{keyword}||'%']]>
		</if>
		<if test="search=='b_name'">
			<![CDATA[b_name like '%'||#{keyword}||'%']]>
		</if>
		<if test="search=='b_date'">
			<![CDATA[to_char(b_date,'yyyy-mm-dd') between #{start_date} and #{end_date}]]>
		</if>
	</where>
</sql>
<select id="boardList" parameterType="board" resultType="board">
	select b_num, b_name, b_title, to_char(b_date,'yyyy-mm-dd hh24:mi:ss') as b_date
	from (select list.*, rownum as rnum 
		from (
		<include refid="boardCommon"/>
		<choose>
			<when test="order_by=='b_num'">
				order by b_num
			</when>
			<when test="order_by=='b_date'">
				order by b_date
			</when>
		</choose>
		<choose>
			<when test="order_sc=='ASC'">
				ASC
			</when>
			<when test="order_sc=='DESC'">
				DESC
			</when>
		</choose>
		)list
	)
	<where>
		<if test="start_row != null and start_row != ''">
			<if test="end_row != null and end_row != ''">
				rnum between #{start_row} and #{end_row}
			</if>
		</if>
	</where>
</select>
<select id="boardListCnt" parameterType="board" resultType="int">
	select nvl(count(1), 0) from (select list.*, rownum as rnum from (
		<include refid="boardCommon"/>
		order by b_num desc
		) list
	) 
</select>
<select id="boardDetail" parameterType="int" resultType="board">
	select b_num, b_name, b_title, b_content, b_file,
	to_char(b_date, 'yyyy-MM-dd hh24:mi:ss') as b_date
	from spring_board where b_num = #{b_num}
</select>
<insert id="boardInsert" parameterType="board">
	<selectKey keyProperty="b_num" resultType="int" order="BEFORE">
		select spring_board_seq.nextval from dual
	</selectKey>
	insert into spring_board(b_num, b_name, b_title, b_content, 
	<if test="b_file != null and b_file != ''">b_file,</if> b_pwd)
	values (#{b_num}, #{b_name}, #{b_title}, #{b_content}, 
	<if test="b_file != null and b_file != ''">#{b_file},</if>#{b_pwd})
</insert>
<select id="pwdConfirm" parameterType="board" resultType="int">
	select nvl((select 1 from spring_board where b_num = #{b_num} and b_pwd = #{b_pwd}),0) as state
	from dual
</select>
<update id="boardUpdate" parameterType="board">
	update spring_board set b_title = #{b_title}, b_content = #{b_content}, b_date = sysdate
	<if test="b_file != ''">, b_file = #{b_file} </if>
	<if test="b_pwd != ''">, b_pwd = #{b_pwd} </if> 
	where b_num = #{b_num}
</update>
<delete id="boardDelete" parameterType="board">
	delete from spring_board where b_num = #{b_num}
</delete>
</mapper>